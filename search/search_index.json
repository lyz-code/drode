{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Drode","text":"<p><code>drode</code> is a wrapper over the Drone and AWS APIs to make deployments more user friendly.</p> <p>It assumes that the projects are configured to continuous deliver all commits to staging. Then those commits can be promoted to production or to staging for upgrades and rollbacks.</p> <p>It has the following features:</p> <ul> <li>Prevent failed jobs to be promoted to production.</li> <li>Promote jobs with less arguments than the drone command line.</li> <li>Wait for a drone build to end, then raise the terminal bell.</li> </ul>"},{"location":"#installing","title":"Installing","text":"<p>To install <code>drode</code>, simply:</p> <pre><code>pip install drode\n</code></pre> <p><code>drode</code> configuration is done through the yaml file located at <code>~/.local/share/drode/config.yaml</code>. The default template is provided at installation time.</p> <p>It is assumed that Drone environmental variables <code>DRONE_SERVER</code> and <code>DRONE_TOKEN</code> are configured as well as the AWS CLI credentials. Please refer to their documentation in case of doubt. To check if everything works as expected use <code>drode verify</code>:</p> <pre><code>$: drode verify\n  [INFO] Drode: 0.1.0\n  [INFO] Drone: OK\n  [INFO] AWS: OK\n</code></pre>"},{"location":"#a-simple-example","title":"A simple example","text":"<p>Let's see <code>drode</code> in action.</p> <p>Imagine a push in <code>main</code> triggers a drone job.</p> <p>Drone jobs can take from seconds to dozens of minutes. Keeping a constant eye on the job status introduces several undesired context changes. You can use the <code>wait</code> subcommand to release your mind of that burden. It will periodically check the job status and rise the terminal bell once it's finished. You can specify a job number, It monitors the last job by default, but you can specify any job number.</p> <pre><code>$: drode wait\n[INFO] Waiting for job #213 started by a promote event by lyz.\n# (... some time ...)\n[INFO] Job #213 has finished with status success\n</code></pre> <p>Once the push job has finished successfully, we can promote it to the production environment.</p> <pre><code>$: drode promote\n  [INFO] You're about to promote job #213 of the project drode_website to production\n[INFO] With commit 347579b: Add drode promote documentation\n\nAre you sure? [y/n]: y\n  [INFO] Job #214 has started.\n</code></pre> <p><code>drode promote</code> promotes to production the last successful job originated by a push event in <code>main</code>. You are given the information of the job and are prompted if you want to continue. Only <code>y</code> or <code>yes</code> will complete the deployment.</p> <p>Optionally you can specify which job number to deploy in which environment with something like <code>drode promote 210 staging</code>.</p> <p>With the <code>-w</code> flag, <code>drode promote</code> will launch the job and then <code>wait</code> for it to finish.</p> <p>If you try to promote a failed job, you'll get the following error:</p> <pre><code>  [ERROR] You can't promote job #200 to production as it's status is failure\n</code></pre> <p><code>drode</code> is also able to give insights of the instances related to a project. If you've configured the <code>aws</code> section of the project configuration, it will be shown after executing the <code>status</code> subcommand.</p> <pre><code>$: drode status\n# Production\nActive LaunchConfiguration: production-project_1-238-32gosdkon3hlglkshonbllsdk32023950lskenbl\nInstance             IP           Status             Created           LaunchConfiguration\n-------------------  -----------  -----------------  ----------------  -----------------------------------\ni-gasklk3bnl23880sl  192.71.1.42  Healthy/InService  2020-06-09T04:02  production-project_1-238-32gosdkon3h\ni-2osdkgh3nbbbl0sk3  192.83.3.86  Healthy/InService  2020-06-09T04:03  production-project_1-238-32gosdkon3h\n\n# Staging\nActive LaunchConfiguration: staging-icijweb-240-237e9e9fb759bab18cc52ad5b7c407e9975831d3\nInstance             IP            Status             Created           LaunchConfiguration\n-------------------  ------------  -----------------  ----------------  -----------------------------------\ni-32okgadslk3jos03l  192.21.2.158  Healthy/InService  2020-06-09T18:50  staging-project_1-238-32gosdkon3h\n</code></pre>"},{"location":"#multiple-projects-support","title":"Multiple projects support","text":"<p>If you have more than one project configured, <code>drode</code> needs to know which one to act upon. Instead of defining it through command flags, we use the <code>set</code> command.</p> <pre><code>drode set project_1\n</code></pre> <p>To check the active project use <code>drode active</code>.</p>"},{"location":"#references","title":"References","text":"<p>As most open sourced programs, <code>drode</code> is standing on the shoulders of giants, namely:</p> Pytest Testing framework, enhanced by the awesome pytest-cases library that made the parametrization of the tests a lovely experience. Mypy Python static type checker. Flakeheaven Python linter with lots of checks. Black Python formatter to keep a nice style without effort. Autoimport Python formatter to automatically fix wrong import statements. isort Python formatter to order the import statements. PDM Command line tool to manage the dependencies. Mkdocs To build this documentation site, with the Material theme. Safety To check the installed dependencies for known security vulnerabilities. Bandit To finds common security issues in Python code. Yamlfix YAML fixer."},{"location":"#contributing","title":"Contributing","text":"<p>For guidance on setting up a development environment, and how to make a contribution to drode, see Contributing to drode.</p>"},{"location":"#donations","title":"Donations","text":"<p> or </p> <p>If you are using some of my open-source tools, have enjoyed them, and want to say \"thanks\", this is a very strong way to do it.</p> <p>If your product/company depends on these tools, you can sponsor me to ensure I keep happily maintaining them.</p> <p>If these tools are helping you save money, time, effort, or frustrations; or they are helping you make money, be more productive, efficient, secure, enjoy a bit more your work, or get your product ready faster, this is a great way to show your appreciation. Thanks for that!</p> <p>And by sponsoring me, you are helping make these tools, that already help you, sustainable and healthy.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>So you've started using <code>drode</code> and want to show your gratitude to the project, depending on your programming skills there are different ways to do so.</p>"},{"location":"contributing/#i-dont-know-how-to-program","title":"I don't know how to program","text":"<p>There are several ways you can contribute:</p> <ul> <li>Open an issue if you encounter     any bug or to let us know if you want a new feature to be implemented.</li> <li>Spread the word about the program.</li> <li>Review the documentation and try to improve     it.</li> </ul>"},{"location":"contributing/#i-know-how-to-program-in-python","title":"I know how to program in Python","text":"<p>If you have some python knowledge there are some additional ways to contribute. We've ordered the issues in milestones, check the issues in the smaller one, as it's where we'll be spending most of our efforts. Try the good first issues, as they are expected to be easier to get into the project.</p> <p>We develop the program with TDD, so we expect any contribution to have it's associated tests. We also try to maintain an updated documentation of the project, so think if your contribution needs to update it.</p> <p>We know that the expected code quality is above average. Therefore it might be changeling to get the initial grasp of the project structure, know how to make the tests, update the documentation or use all the project technology stack. but please don't let this fact discourage you from contributing:</p> <ul> <li>If you want to develop a new feature, explain how you'd like to do it in the related issue.</li> <li>If you don't know how to test your code, do the pull request without the tests     and we'll try to do them for you.</li> </ul>"},{"location":"contributing/#issues","title":"Issues","text":"<p>Questions, feature requests and bug reports are all welcome as issues. To report a security vulnerability, please see our security policy instead.</p> <p>To make it as simple as possible for us to help you, please include the output of the following call in your issue:</p> <pre><code>python -c \"import drode.version; print(drode.version.version_info())\"\n</code></pre> <p>or if you have <code>make</code> installed, you can use <code>make version</code>.</p> <p>Please try to always include the above unless you're unable to install <code>drode</code> or know it's not relevant to your question or feature request.</p>"},{"location":"contributing/#pull-requests","title":"Pull Requests","text":"<p>drode is released regularly so you should see your improvements release in a matter of days or weeks.</p> <p>Note</p> <p>Unless your change is trivial (typo, docs tweak etc.), please create an issue to discuss the change before creating a pull request.</p> <p>If you're looking for something to get your teeth into, check out the \"help wanted\" label on github.</p>"},{"location":"contributing/#development-facilities","title":"Development facilities","text":"<p>To make contributing as easy and fast as possible, you'll want to run tests and linting locally.</p> <p>tl;dr: use <code>make format</code> to fix formatting, <code>make</code> to run tests and linting &amp; <code>make docs</code> to build the docs.</p> <p>You'll need to have python 3.6, 3.7, or 3.8, virtualenv, git, and make installed.</p> <ul> <li> <p>Clone your fork and go into the repository directory:</p> <pre><code>git clone git@github.com:&lt;your username&gt;/drode.git\ncd drode\n</code></pre> </li> <li> <p>Set up the virtualenv for running tests:</p> <pre><code>virtualenv -p `which python3.7` env\nsource env/bin/activate\n</code></pre> </li> <li> <p>Install <code>pdm</code> our package manager with the next command or using any of the     other recommended     methods.</p> <pre><code>curl -sSL https://raw.githubusercontent.com/pdm-project/pdm/main/install-pdm.py | python3 -\n</code></pre> </li> <li> <p>Install drode, dependencies and configure the     pre-commits:</p> <pre><code>make install\n</code></pre> </li> <li> <p>Checkout a new branch and make your changes:</p> <pre><code>git checkout -b my-new-feature-branch\n</code></pre> </li> <li> <p>Fix formatting and imports: drode uses     black to enforce formatting and     isort to fix imports.</p> <pre><code>make format\n</code></pre> </li> <li> <p>Run tests and linting:</p> <pre><code>make\n</code></pre> <p>There are more sub-commands in Makefile like <code>test-code</code>, <code>test-examples</code>, <code>mypy</code> or <code>security</code> which you might want to use, but generally <code>make</code> should be all you need.</p> <p>If you need to pass specific arguments to pytest use the <code>ARGS</code> variable, for example <code>make test ARGs='-k test_markdownlint_passes'</code>.</p> </li> <li> <p>Build documentation: If you have changed the documentation, make sure it     builds the static site. Once built it will serve the documentation at     <code>localhost:8000</code>:</p> <pre><code>make docs\n</code></pre> </li> <li> <p>Commit, push, and create your pull request.</p> </li> <li> <p>Make a new release: To generate the changelog of the new changes, build the     package, upload to pypi and clean the build files use <code>make bump</code>.</p> </li> </ul> <p>We'd love you to contribute to drode!</p>"},{"location":"reference/","title":"Reference","text":""},{"location":"reference/#drode","title":"<code>drode</code>","text":"<p>Wrapper over the Drone and AWS APIs to make deployments more user friendly.</p>"},{"location":"adr/adr/","title":"Adr","text":"<p>ADR are short text documents that captures an important architectural decision made along with its context and consequences.</p> <pre><code>graph TD\n    001[001: High level analysis]\n    002[002: Initial Program design]\n\n    001 -- Extended --&gt; 002\n\n    click 001 \"https://lyz-code.github.io/drode/adr/001-high_level_problem_analysis\" _blank\n    click 002 \"https://lyz-code.github.io/drode/adr/002-initial_program_design\" _blank\n\n    001:::draft\n    002:::draft\n\n    classDef draft fill:#CDBFEA;\n    classDef proposed fill:#B1CCE8;\n    classDef accepted fill:#B1E8BA;\n    classDef rejected fill:#E8B1B1;\n    classDef deprecated fill:#E8B1B1;\n    classDef superseeded fill:#E8E5B1;</code></pre>"}]}